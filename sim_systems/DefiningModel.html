
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Basic generator for a function describing a MKM reaction system &#8212; Simple surface reaction simulations</title>
    
  <link href="_static/css/theme.css" rel="stylesheet" />
  <link href="_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/sphinx-book-theme.acff12b8f9c144ce68a297486a2fa670.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="PSD analysis of different cases of (simulated) reaction systems" href="MES-PSD_intro.html" />
    <link rel="prev" title="Revealing reaction behaviour by modulation" href="modelintro.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
      <img src="_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Simple surface reaction simulations</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="modelintro.html">
   Revealing reaction behaviour by modulation
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Basic generator for a function describing a MKM reaction system
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="MES-PSD_intro.html">
   PSD analysis of different cases of (simulated) reaction systems
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/DefiningModel.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/hCarlFelix/hcarlfelix.github.io/sim_systems"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/hCarlFelix/hcarlfelix.github.io/sim_systems/issues/new?title=Issue%20on%20page%20%2FDefiningModel.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/hCarlFelix/hcarlfelix.github.io/master?urlpath=tree/docs/DefiningModel.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-reaction-system">
   The reaction system
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="basic-generator-for-a-function-describing-a-mkm-reaction-system">
<h1>Basic generator for a function describing a MKM reaction system<a class="headerlink" href="#basic-generator-for-a-function-describing-a-mkm-reaction-system" title="Permalink to this headline">¶</a></h1>
<blockquote>
<div><p><strong>Modules used in this example:</strong> NumPy, SciPy, Matplotlib</p>
</div></blockquote>
<blockquote>
<div><p><strong>Limitations:</strong> Mean-field approximation, elementary reaction steps, no mass transfer limitation</p>
</div></blockquote>
<div class="section" id="the-reaction-system">
<h2>The reaction system<a class="headerlink" href="#the-reaction-system" title="Permalink to this headline">¶</a></h2>
<p>See the following reaction system for the hydrogenation of CO<span class="math notranslate nohighlight">\(_2\)</span> into CO and CH<span class="math notranslate nohighlight">\(_3\)</span>OH.</p>
<br>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align}
    \text{H$_2$ (g)} + 2∗ &amp;\rightleftharpoons 2\text{H}^∗\tag{0}\\
    \text{CO}_2 + \text{H}^* &amp;\rightleftharpoons \text{HCOO}^∗\tag{1}\\
    \text{HCOO}^∗ + \text{H}^* &amp;\rightleftharpoons \text{HCOOH}^∗ + ∗\tag{2}\\
    \text{HCOOH}^∗ + \text{H}^* &amp;\rightleftharpoons \text{CH$_2$OOH} + ∗\tag{3}\\
    \text{CH$_2$OOH}^∗ + * &amp;\rightleftharpoons \text{CH$_2$O}^* + \text{OH}^∗\tag{4}\\
    \text{OH}^∗ + \text{H}* &amp;\rightleftharpoons \text{H$_2$O}^* + ∗\tag{5}\\
    \text{CH$_2$O}^∗ + \text{H}* &amp;\rightleftharpoons \text{CH$_3$O}^* + ∗\tag{6}\\
    \text{CH$_3$O}^∗ + \text{H}* &amp;\rightleftharpoons \text{CH$_3$OH}^* + ∗\tag{7}\\
    \text{CO$_2$ (g)} + * &amp;\rightleftharpoons \text{CO$_2$}^* + ∗\tag{8}\\
    \text{CO$_2$}^∗ + \text{H}* &amp;\rightleftharpoons \text{COOH}^* + ∗\tag{9}\\
    \text{COOH}^∗ &amp;\rightleftharpoons \text{CO (g)} + \text{OH}^∗\tag{10}\\
    \text{CHOO}^∗ + \text{H}^* &amp;\rightleftharpoons \text{CH$_2$OO}^* + ∗\tag{11}\\
    \text{CH$_2$OO}^∗ + \text{H}^* &amp;\rightleftharpoons \text{CH$_2$OOH}^* + ∗\tag{12}\\
    \text{H$_2$O}^∗ &amp;\rightleftharpoons \text{H$_2$O (g)} + ∗\tag{13}\\
    \text{CH$_3$OH}^∗ &amp;\rightleftharpoons \text{CH$_3$OH (g)} + ∗\tag{14}\\
\end{align}
\end{split}\]</div>
<br>
<p>We can express the reaction rate for each of these equilibrium reactions by simple elementary steps, such as:</p>
<br>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align}
    r_0 &amp;= k_{0,0} \, \theta_\text{∗}^2  \, p_\text{H$_2$}      - k_{1,0} \, \theta_\text{H}^2\\
    r_1 &amp;= k_{0,1} \, \theta_\text{∗}    \, p_\text{CO$_2$}     - k_{1,1} \, \theta_\text{CHOO}\\
    \vdots &amp; \\
    r_{14} &amp;= k_{0,14} \, \theta_\text{CH$_3$OH}   \,           - k_{1,14} \, p_\text{CH$_3$OH}\\
\end{align}
\end{split}\]</div>
<br>
<p>Of which <span class="math notranslate nohighlight">\(k_{0, i}\)</span> is the reaction constant for the forwards reaction of equilibrium step <span class="math notranslate nohighlight">\(i\)</span> and <span class="math notranslate nohighlight">\(k_{1, i}\)</span> is that of the backwards reaction.</p>
<br>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{equation}
k = 
\begin{bmatrix}
    k_{0,0} &amp; k_{0,1} &amp; \ldots &amp; k_{0,14} \\
    k_{1,0} &amp; k_{1,1} &amp; \ldots &amp; k_{1,14}
\end{bmatrix}
\end{equation}
\end{split}\]</div>
<br>
<p>To later on solving the change of a surface species, one would simply obtain the sum of these reaction rates (multiplied with respective stoichiometric constant) for which it partakes.</p>
<br>
<div class="math notranslate nohighlight">
\[
\begin{equation}
    \dfrac{\partial \theta_\text{H}}{\partial t} = 2 r_0 - r_1 - r_2 - r_3 - r_5 - r_6 - r_7 - r_9 - r_{11} - r_{12}
\end{equation}
\]</div>
<br>
<p>Manually writing a function describing this system could be quite a tedious task, especially as it would have to be redone everytime the definiton of the system changes. It would therefore be of interest to instead have a function which can construct this function based on a few parameters.</p>
<p>Given that we can express all the reactions and their rates as elementary steps, only the stoichiometery of the species is needed to construct an expression of this reaction system. For example, the rate expression <span class="math notranslate nohighlight">\(r_0\)</span> and the change in <span class="math notranslate nohighlight">\(\theta_\text{H}\)</span> evaluated for <span class="math notranslate nohighlight">\(r_0\)</span> can be expressed as:</p>
<br>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align}
    r_0 &amp;= k_{0,0} \, \theta_\text{∗}^{\nu_{*, 0}} \, p_{H2}^{\nu_{H2}, 0} - k_{1,0} \, \theta_H^{\nu_{H^*}, 0}\\
    \left. \dfrac{\partial \theta_\text{H}}{\partial t} \right|_{r = r_0} &amp;= \nu_{\text{H}, 0} \, r_0
\end{align}
\end{split}\]</div>
<br>
<p>As such, all we need is the stoichiometry, reaction constants and initial conditions in order to solve the problem. The variables we will look at belongs to two domains, the coverage by surface species (<span class="math notranslate nohighlight">\(x_\theta\)</span>) and the partial pressure of the gases (<span class="math notranslate nohighlight">\(x_p\)</span>), who together form the all the variables of the system (<span class="math notranslate nohighlight">\(x\)</span>).</p>
<br>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{equation}
x_\theta = 
\begin{bmatrix}
    \theta_\text{∗} &amp; \theta_\text{H} &amp; \theta_\text{CHOO} &amp; \theta_\text{CHOOH} &amp; \theta_\text{CH$_2$OOH} &amp; \theta_\text{OH} &amp; \theta_\text{CH$_2$O} &amp; \theta_\text{CH$_3$O} &amp; \theta_\text{CO$_2$} &amp; \theta_\text{COOH} &amp; \theta_\text{CH$_2$OO} &amp; \theta_\text{H$_2$O} &amp; \theta_\text{CH$_3$OH}\\
\end{bmatrix}
\end{equation}
\end{split}\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{equation}
x_p = 
\begin{bmatrix}
    p_\text{H$_2$} &amp; p_\text{CO$_2$} &amp; p_\text{CO} &amp; p_\text{H$_2$O} &amp; p_\text{CH$_3$OH} \\
\end{bmatrix}
\end{equation}
\end{split}\]</div>
<div class="math notranslate nohighlight">
\[
\begin{equation}
x = 
\begin{bmatrix}
    x_\theta &amp; x_p
\end{bmatrix}
\end{equation}
\]</div>
<br>
<p>Based on equation (0) to (14), we can construct the following stoichiometry matrix (<span class="math notranslate nohighlight">\(S\)</span>), for which the rows correspond to <span class="math notranslate nohighlight">\(x\)</span> and columns to <span class="math notranslate nohighlight">\(r\)</span>.</p>
<br>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{equation}
    S =
    %r_0 &amp; r_1 &amp; r_2 &amp; r_3 &amp; r_4 &amp; r_5 &amp; r_6 &amp; r_7 &amp; r_8 &amp; r_9 &amp; r_{10} &amp; r_{11} &amp; r_{12} &amp; r_{13} &amp; r_{14}\\
%\begin{array}{c*{15}}
\begin{bmatrix}
    -2 &amp;  0 &amp;  1 &amp;  1 &amp; -1 &amp;  1 &amp;  1 &amp;  1 &amp; -1 &amp;  1 &amp;  0 &amp;  1 &amp;  1 &amp;  1 &amp;  1\\
     2 &amp; -1 &amp; -1 &amp; -1 &amp;  0 &amp; -1 &amp; -1 &amp; -1 &amp;  0 &amp; -1 &amp;  0 &amp; -1 &amp; -1 &amp;  0 &amp;  0\\
     0 &amp;  1 &amp; -1 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp; -1 &amp;  0 &amp;  0 &amp;  0\\
     0 &amp;  0 &amp;  1 &amp; -1 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0\\
     0 &amp;  0 &amp;  0 &amp;  1 &amp; -1 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  1 &amp;  0 &amp;  0\\
     0 &amp;  0 &amp;  0 &amp;  0 &amp;  1 &amp; -1 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  1 &amp;  0 &amp;  0 &amp;  0 &amp;  0\\
     0 &amp;  0 &amp;  0 &amp;  0 &amp;  1 &amp;  0 &amp; -1 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0\\
     0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  1 &amp; -1 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0\\
     0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  1 &amp; -1 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0\\
     0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  1 &amp; -1 &amp;  0 &amp;  0 &amp;  0 &amp;  0\\
     0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  1 &amp; -1 &amp;  0 &amp;  0\\
     0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  1 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp; -1 &amp;  0\\
     0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  1 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp; -1\\
    -1 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0\\
     0 &amp; -1 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp; -1 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0\\
     0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  1 &amp;  0 &amp;  0 &amp;  0 &amp;  0\\
     0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  1 &amp;  0\\
     0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  1\\
\end{bmatrix}
%\end{array}
\end{equation}
\end{split}\]</div>
<p>As this can be quite a labourious task for larger systems (with a high risk of making mistakes), we may instead opt for defining a function which can construct it for us. The input parameters to this function could then be a list declaring the variables of the system (and in which order we would like them listed in the resulting stoichiometry matrix) and a list of the reaction expressions. In the reaction expressions, we’ll use <code class="docutils literal notranslate"><span class="pre">+</span></code> as the delimiter between the different species and <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> to separate the reactant and product.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vars_chem</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;H*&quot;</span><span class="p">,</span> <span class="s2">&quot;HCOO*&quot;</span><span class="p">,</span> <span class="s2">&quot;HCOOH*&quot;</span><span class="p">,</span> <span class="s2">&quot;CH2OOH*&quot;</span><span class="p">,</span> <span class="s2">&quot;OH*&quot;</span><span class="p">,</span> <span class="s2">&quot;CH2O*&quot;</span><span class="p">,</span> 
             <span class="s2">&quot;CH3O*&quot;</span><span class="p">,</span> <span class="s2">&quot;CO2*&quot;</span><span class="p">,</span> <span class="s2">&quot;COOH*&quot;</span><span class="p">,</span> <span class="s2">&quot;CH2OO*&quot;</span><span class="p">,</span> <span class="s2">&quot;H2O*&quot;</span><span class="p">,</span> <span class="s2">&quot;CH3OH*&quot;</span><span class="p">,</span> 
             <span class="s2">&quot;H2 (g)&quot;</span><span class="p">,</span> <span class="s2">&quot;CO2 (g)&quot;</span><span class="p">,</span> <span class="s2">&quot;CO (g)&quot;</span><span class="p">,</span> <span class="s2">&quot;H2O (g)&quot;</span><span class="p">,</span> <span class="s2">&quot;CH3OH (g)&quot;</span><span class="p">]</span>

<span class="n">reactions</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;H2 (g) + 2* -&gt; 2H*&quot;</span><span class="p">,</span>
             <span class="s2">&quot;CO2 (g) + H* -&gt; HCOO*&quot;</span><span class="p">,</span>
             <span class="s2">&quot;HCOO* + H* -&gt; HCOOH* + *&quot;</span><span class="p">,</span>
             <span class="s2">&quot;HCOOH* + H* -&gt; CH2OOH* + *&quot;</span><span class="p">,</span>
             <span class="s2">&quot;CH2OOH* + * -&gt; CH2O* + OH*&quot;</span><span class="p">,</span>
             <span class="s2">&quot;OH* + H* -&gt; H2O* + *&quot;</span><span class="p">,</span>
             <span class="s2">&quot;CH2O* + H* -&gt; CH3O* + *&quot;</span><span class="p">,</span>
             <span class="s2">&quot;CH3O* + H* -&gt; CH3OH* + *&quot;</span><span class="p">,</span>
             <span class="s2">&quot;CO2 (g) + * -&gt; CO2*&quot;</span><span class="p">,</span>
             <span class="s2">&quot;CO2* + H* -&gt; COOH* + *&quot;</span><span class="p">,</span>
             <span class="s2">&quot;COOH* -&gt; CO (g) + OH*&quot;</span><span class="p">,</span>
             <span class="s2">&quot;HCOO* + H* -&gt; CH2OO* + *&quot;</span><span class="p">,</span>
             <span class="s2">&quot;CH2OO* + H* -&gt; CH2OOH* + *&quot;</span><span class="p">,</span>
             <span class="s2">&quot;H2O* -&gt; H2O (g) + *&quot;</span><span class="p">,</span>
             <span class="s2">&quot;CH3OH* -&gt; CH3OH (g) + *&quot;</span><span class="p">,</span>
            <span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>It then becomes a simple task of using regex in order to split the expression into its constituent variables and to check for their stoichiometry factor, as done for example, in the <code class="docutils literal notranslate"><span class="pre">constr_stoichio()</span></code> function below. In this case, the <code class="docutils literal notranslate"><span class="pre">constr_stoichio()</span></code> is only used to construct the stoichiometry matrix so information such as reversibility of the reaction is not of interest. However, if incorporated with another function which solves for instance reaction constants, then one would perhaps like to include additional parameters such as denoting <code class="docutils literal notranslate"><span class="pre">&lt;-&gt;</span></code> for reversible reaction or such.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>

<span class="k">def</span> <span class="nf">constr_stoichio</span><span class="p">(</span><span class="n">lst_var</span><span class="p">,</span> <span class="n">lst_react</span><span class="p">):</span>
    <span class="n">stoichio_m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">lst_var</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">lst_react</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">)</span>
    
    <span class="n">react_split</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lst_react</span><span class="p">):</span>
        <span class="n">reaction</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\+| (-&gt;)&quot;</span><span class="p">,</span> <span class="n">reaction</span><span class="p">)))</span>
        <span class="n">reaction</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">reaction</span><span class="p">]</span>
        <span class="n">react_split</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">reaction</span><span class="p">)</span> 
    
    <span class="k">for</span> <span class="n">react_nr</span><span class="p">,</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">react_split</span><span class="p">):</span>
        <span class="n">left_side</span> <span class="o">=</span> <span class="kc">True</span>
        
        <span class="k">for</span> <span class="n">react_var</span> <span class="ow">in</span> <span class="n">reaction</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">react_var</span> <span class="o">==</span> <span class="s2">&quot;-&gt;&quot;</span><span class="p">:</span>
                <span class="n">left_side</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">str_nu</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\d+&#39;</span><span class="p">,</span> <span class="n">react_var</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
                    <span class="n">nu</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">str_nu</span><span class="p">)</span>
                    <span class="n">react_var</span> <span class="o">=</span> <span class="n">react_var</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">str_nu</span><span class="p">):]</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">nu</span> <span class="o">=</span> <span class="mi">1</span>

                <span class="k">if</span> <span class="n">left_side</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">nu</span> <span class="o">=</span> <span class="n">nu</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="n">stoichio_idx</span> <span class="o">=</span> <span class="n">lst_var</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">react_var</span><span class="p">)</span>
                    <span class="n">stoichio_m</span><span class="p">[</span><span class="n">stoichio_idx</span><span class="p">,</span> <span class="n">react_nr</span><span class="p">]</span> <span class="o">=</span> <span class="n">nu</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">react_var</span> 
                          <span class="o">+</span> <span class="s2">&quot; doesn&#39;t exist in the list of variables.</span><span class="se">\n</span><span class="s2">&quot;</span> \
                          <span class="o">+</span> <span class="s2">&quot;Reaction &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">react_nr</span><span class="p">)</span> \
                          <span class="o">+</span> <span class="s2">&quot; is potentially incorrect.</span><span class="se">\n</span><span class="s2">&quot;</span> \
                          <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">lst_react</span><span class="p">[</span><span class="n">react_nr</span><span class="p">])</span> \
                          <span class="p">)</span>
    
    <span class="k">return</span> <span class="n">stoichio_m</span>
</pre></div>
</div>
</div>
</div>
<p>We might also want to check that the original expressions were correctly balanced. In the reaction system of this example, the number of surface sites remain constant. As such, we would expect to be able to solve <span class="math notranslate nohighlight">\(A x = 0\)</span> for the surface species and sites, ergo a null space should exist for the part of the matrix composed of the surface species. We could then do the following test (making sure to exclude the gas species):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy.linalg</span> <span class="k">import</span> <span class="n">null_space</span>

<span class="n">calc_stoichio</span> <span class="o">=</span> <span class="n">constr_stoichio</span><span class="p">(</span><span class="n">vars_chem</span><span class="p">,</span> <span class="n">reactions</span><span class="p">)</span>
<span class="n">null_space</span><span class="p">(</span><span class="n">calc_stoichio</span><span class="p">[:</span><span class="o">-</span><span class="mi">5</span><span class="p">,:])</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<p>So, here we have the class <code class="docutils literal notranslate"><span class="pre">BasicReactionModel</span></code> which we will use in order to solve our reaction system. In order to initialize an instance, we will need to supply reaction rate constants and a stoichiometry matrix (which we previously obtained from <code class="docutils literal notranslate"><span class="pre">constr_stoichio</span></code>). Note that as it is a class, we can easily setup several instances of reaction systems who are closed off from each other.</p>
<p>The concept of <code class="docutils literal notranslate"><span class="pre">BasicReactionModel</span></code> is as follows: the forwards and backwards reaction rates () are defined by equation <span class="math notranslate nohighlight">\(\text{(r.1)}\)</span> and <span class="math notranslate nohighlight">\(\text{(r.2)}\)</span>, resulting in a vector, <span class="math notranslate nohighlight">\(\pmb{r}\)</span>, containing the net forward rate, equation<span class="math notranslate nohighlight">\(\text{(r.3)}\)</span>. A matrix multiplication between the stoichiometry matrix <span class="math notranslate nohighlight">\(\pmb{S}\)</span> and the rate vector <span class="math notranslate nohighlight">\(\pmb{r}\)</span> results in a matrix consisting of the differential for each variable in regards to every reaction step.</p>
<br>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align}
r_{i, \text{f}} &amp;= k_{i, \text{f}} \underset{j=1}{\overset{n}{\prod}} \mid f(\nu_{i, j})\mid &amp; 
f(\nu_{i, j}) = \left\{
    \begin{array}{ll}
        x_i^{\mid \nu_{i, j} \mid } &amp; \nu_{i, j} &lt; 0 \\
        1 &amp; \text{else}
    \end{array}
\right. \tag{r.1}\\
r_{i, \text{b}} &amp;= k_{i, \text{b}} \underset{j=1}{\overset{n}{\prod}} \mid g(\nu_{i, j})\mid &amp; 
g(\nu_{i, j}) = \left\{
    \begin{array}{ll}
        x_i^{\mid \nu_{i, j} \mid } &amp; \nu_{i, j} &gt; 0 \\
        1 &amp; \text{else}
    \end{array}
\right. \tag{r.2}\\
&amp;\\
\pmb{r} &amp;= r_{\text{f}} - r_{\text{b}} \tag{r.3}\\
&amp;\\
\dfrac{\partial \pmb{x}}{\partial t} &amp;= \pmb{S} \, \pmb{r} \tag{r.4}
\end{align}
\end{split}\]</div>
<br>
<p>While the stoichiometry matrix is conventionally written as above with variables in the row dimension and reactions in the column, <code class="docutils literal notranslate"><span class="pre">BasicReactionModel</span></code> instead utilises the transponate of this matrix in order to gain a more simple calculation.</p>
<p>To preserve constant terms (perhaps partial pressures) as constants, an additional vector <code class="docutils literal notranslate"><span class="pre">const_term</span></code> can be supplied to the class instance, declaring the variable as constant (<code class="docutils literal notranslate"><span class="pre">True</span></code>) or not (<code class="docutils literal notranslate"><span class="pre">False</span></code>). If <code class="docutils literal notranslate"><span class="pre">const_term</span></code> is given as <span class="math notranslate nohighlight">\(C(x_i)\)</span>, then one may express it as:</p>
<br>
<div class="math notranslate nohighlight">
\[
C(x_i) = \text{True} \Rightarrow \dfrac{\partial x_i}{\partial t} = 0
\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BasicReactionModel</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Constructs a reaction model to be used in microkinetic modelling.</span>
<span class="sd">    </span>
<span class="sd">    To define a reaction system, a stoichiometry matrix must be given during the</span>
<span class="sd">    initialisation of the class instance as well as a list of reaction rate </span>
<span class="sd">    constants. If one or more variables are to be treated as constants, then the</span>
<span class="sd">    optional argument const_term must be given.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    const_react : numpy array</span>
<span class="sd">      The constant terms (e.g reaction rate constant) of the forward (row 0) and </span>
<span class="sd">      backward reaction (row 1) of the net reaction (col).</span>
<span class="sd">    stoichi : numpy array</span>
<span class="sd">      The stoichiometry matrix of the reaction system for the reactions </span>
<span class="sd">      (row) and species (col).</span>
<span class="sd">    exp : numpy array</span>
<span class="sd">      The exponents of the reaction terms (col) at different reactions (row)</span>
<span class="sd">    const_term : numpy array</span>
<span class="sd">      1D Boolean array, defines which reaction terms that are set as </span>
<span class="sd">      constants (True) and variables (False). Defaults to no constants. </span>
<span class="sd">    forwM : numpy array</span>
<span class="sd">      2D Boolean array, signifying variables used for the forward reaction.</span>
<span class="sd">    backM : numpy array</span>
<span class="sd">      2D Boolean array, signifying variables used for the backward reaction.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">const_react</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span>
                 <span class="n">stoichi</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span>
                 <span class="n">const_term</span><span class="o">=</span><span class="p">{},</span>
                 <span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">stoichio</span><span class="p">(</span><span class="n">stoichi</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">const_term</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__init__</span><span class="o">.</span><span class="vm">__defaults__</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">const_term</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">stoichi</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        
        <span class="k">if</span> <span class="n">const_react</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stoichi</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">const_react</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">stoichi</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">const_react</span> <span class="o">=</span> <span class="n">const_react</span><span class="o">.</span><span class="n">T</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Dimension mismatch between const_react </span><span class="se">\</span>
<span class="s1">                                  and stoichi&#39;</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">const</span> <span class="o">=</span> <span class="n">const_term</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">react_const</span><span class="p">(</span><span class="n">const_react</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">stoichio</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stoichi</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stoichi</span> <span class="o">=</span> <span class="n">stoichi</span><span class="o">.</span><span class="n">T</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stoichi</span><span class="p">[:])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">forwM</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stoichi</span> <span class="o">&lt;</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backM</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stoichi</span> <span class="o">&gt;</span> <span class="mi">0</span>
    
    <span class="k">def</span> <span class="nf">react_const</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">const_react</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">forwC</span> <span class="o">=</span> <span class="n">const_react</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backC</span> <span class="o">=</span> <span class="n">const_react</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>

    <span class="k">def</span> <span class="nf">reaction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Solves dx/dt given the, for the class instance, predefined stoichiometry</span>
<span class="sd">        matrix and reaction rate constants.</span>
<span class="sd">        </span>
<span class="sd">        It is intended to be used together with an ODE solver such as SciPy&#39;s</span>
<span class="sd">        solve_ivp.        </span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="n">terms</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stoichi</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span> <span class="o">**</span> <span class="bp">self</span><span class="o">.</span><span class="n">exp</span>
        
        <span class="n">forw_r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forwC</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">terms</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">forwM</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">back_r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">backC</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">terms</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">backM</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">dx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stoichi</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">forw_r</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">back_r</span><span class="p">))</span>
        <span class="n">dx</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">const</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">return</span> <span class="n">dx</span>
</pre></div>
</div>
</div>
</div>
<p>Given that we now have the <code class="docutils literal notranslate"><span class="pre">BasicReactionModel</span></code> class, <code class="docutils literal notranslate"><span class="pre">constr_stoichio</span></code> function and the lists of variables and reaction steps (<code class="docutils literal notranslate"><span class="pre">vars_chem</span></code> and <code class="docutils literal notranslate"><span class="pre">reactions</span></code>), we are now ready to define the reaction system.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define starting conditions, setting 100% of sites as unoccupied</span>
<span class="n">surf0</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vars_chem</span><span class="p">)</span> <span class="o">-</span> <span class="mi">6</span><span class="p">)</span>
<span class="c1"># And pressures to some arbitrary pressure &#39;1&#39;</span>
<span class="n">gas0</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">5</span>
<span class="n">x0</span> <span class="o">=</span> <span class="n">surf0</span> <span class="o">+</span> <span class="n">gas0</span>

<span class="c1"># Some made up reaction rate constants, simply set to 1</span>
<span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">reactions</span><span class="p">)]</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># Setting the formation of CO, H2O and CH3OH as irreversible by setting the</span>
<span class="c1"># reaction rate constants for their backwards reaction to 0</span>
<span class="n">ir</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;CO (g)&quot;</span><span class="p">,</span> <span class="s2">&quot;H2O (g)&quot;</span><span class="p">,</span> <span class="s2">&quot;CH3OH (g)&quot;</span><span class="p">]</span>
<span class="n">ir_idx</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ir</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">reactions</span><span class="p">))</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">reactions</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
<span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">ir_idx</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># Likewise, we&#39;ll allow the surface species to vary in coverage but set the</span>
<span class="c1"># partial pressures of the gases as constant</span>
<span class="n">constant_term</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">surf0</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="kc">True</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">gas0</span><span class="p">)</span>

<span class="c1"># Obtain the stoichiometry matrix</span>
<span class="n">stoichi</span> <span class="o">=</span> <span class="n">constr_stoichio</span><span class="p">(</span><span class="n">vars_chem</span><span class="p">,</span> <span class="n">reactions</span><span class="p">)</span>

<span class="c1"># Define the reaction system</span>
<span class="n">TestModel</span> <span class="o">=</span> <span class="n">BasicReactionModel</span><span class="p">(</span><span class="n">k</span><span class="p">,</span>
                               <span class="n">stoichi</span><span class="o">=</span><span class="n">calc_stoichio</span><span class="p">,</span>
                               <span class="n">const_term</span><span class="o">=</span><span class="n">constant_term</span><span class="p">,</span>
                               <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Except the already imported numpy, we’ll also need to import SciPy as we wish to use its initial value ODE solver <code class="docutils literal notranslate"><span class="pre">scipy.integrate.solve_ivp</span></code>. While we are at it, we’ll also import matplotlib so that we can plot the results in the end.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">scipy</span>
<span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="k">import</span> <span class="n">odeint</span>

<span class="c1">#%matplotlib widget</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
<p>After defining the time span and error tolerance, we can then run the ODE solver. For this example, we’ll use the default Runge-Kutta 45 solver.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setting time span for the IVP ODE solver</span>
<span class="n">t_span</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>

<span class="c1"># ... and error tolerance</span>
<span class="n">res</span> <span class="o">=</span> <span class="mf">1.0e-12</span>
<span class="n">AbsTol</span> <span class="o">=</span> <span class="p">[</span><span class="n">res</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">vars_chem</span><span class="p">)</span>
<span class="n">RelTol</span> <span class="o">=</span> <span class="n">res</span>

<span class="n">ans1</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">integrate</span><span class="o">.</span><span class="n">solve_ivp</span><span class="p">(</span><span class="n">TestModel</span><span class="o">.</span><span class="n">reaction</span><span class="p">,</span> 
                                 <span class="n">t_span</span><span class="p">,</span> 
                                 <span class="n">x0</span><span class="p">,</span> 
                                 <span class="n">rtol</span><span class="o">=</span><span class="n">RelTol</span><span class="p">,</span> 
                                 <span class="n">atol</span><span class="o">=</span><span class="n">AbsTol</span><span class="p">,</span>
                                 <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>While we could create a new instance if we would like to change a parameter of the model (for instance the reaction constants), we may also modify the existing one.</p>
<p>For this example, let’s increase the rate constant of the dissociative adsorption of H<span class="math notranslate nohighlight">\(_2\)</span> from the previous 1 to 10.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Let&#39;s change the rate constant for the dis. ads. of H2</span>
<span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">TestModel</span><span class="o">.</span><span class="n">react_const</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>

<span class="n">ans2</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">integrate</span><span class="o">.</span><span class="n">solve_ivp</span><span class="p">(</span><span class="n">TestModel</span><span class="o">.</span><span class="n">reaction</span><span class="p">,</span> 
                                 <span class="n">t_span</span><span class="p">,</span> 
                                 <span class="n">x0</span><span class="p">,</span>
                                 <span class="n">rtol</span><span class="o">=</span><span class="n">RelTol</span><span class="p">,</span> 
                                 <span class="n">atol</span><span class="o">=</span><span class="n">AbsTol</span><span class="p">,</span>
                                 <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>And we may now observe the change in reaction behaviour.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Original k&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Coverage &#39;</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">&#39;$\theta$&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">vars_chem</span><span class="p">[:</span><span class="o">-</span><span class="mi">5</span><span class="p">]):</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ans1</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">ans1</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>

<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Changed k&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Coverage &#39;</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">&#39;$\theta$&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">vars_chem</span><span class="p">[:</span><span class="o">-</span><span class="mi">5</span><span class="p">]):</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ans2</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">ans2</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>

<span class="n">h</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="n">h</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper right&quot;</span><span class="p">,</span> 
           <span class="n">ncol</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vars_chem</span><span class="p">[:</span><span class="o">-</span><span class="mi">5</span><span class="p">])</span><span class="o">/</span><span class="mi">3</span><span class="p">)),</span>
           <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span>
           <span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/DefiningModel_18_0.png" src="_images/DefiningModel_18_0.png" />
</div>
</div>
<p>While this function works for surface reactions, additional work is needed in order to solve liquid and gas phase reactions as parameters such as total volume and volume change is not included. Furthermore, aspects such as mass transfer is also not accounted for. While one could redefine the <code class="docutils literal notranslate"><span class="pre">reaction</span></code> function of <code class="docutils literal notranslate"><span class="pre">BasicReactionModel</span></code>, an alternative is to define additional functions which modifies the input/output in order to account for these additional factors.</p>
<p>As an example, let’s define the function <code class="docutils literal notranslate"><span class="pre">stim_sin</span></code> which allows us to periodically vary one of the parameters using a sinus function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">stim_sin</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">const</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Varies one or more input arguments to a function func with a sinus function.</span>
<span class="sd">    </span>
<span class="sd">    Its intended use is to add a stimulus function to a function to be solved by</span>
<span class="sd">    ODE solver.</span>
<span class="sd">    </span>
<span class="sd">    func : function</span>
<span class="sd">        function describing the ODE system. func(t, x)</span>
<span class="sd">    const : list</span>
<span class="sd">        The coefficient and constant term of the sinus function.</span>
<span class="sd">        x_stim[0] = x[0] * np.sin(const[0, 0] * t + const[0, 1])</span>
<span class="sd">        If const[i, 0] = 0, then x_stim[i] = x[i]</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="n">x_stim</span> <span class="o">=</span> <span class="p">[</span><span class="n">term</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">term</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">t</span> <span class="o">+</span> <span class="n">term</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> 
              <span class="k">if</span> <span class="n">term</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span> 
              <span class="k">else</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> 
              <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">term</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">const</span><span class="p">)]</span>
    
    <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">x_stim</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let us now see how the system behaves if the H<span class="math notranslate nohighlight">\(_2\)</span> feed were perturbed by this sinus function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">period</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">mod_gas</span> <span class="o">=</span> <span class="s2">&quot;H2 (g)&quot;</span>
<span class="n">idx_mod_gas</span> <span class="o">=</span> <span class="n">vars_chem</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">mod_gas</span><span class="p">)</span>
<span class="n">stim_const</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="o">.</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">x0</span><span class="p">))</span>
<span class="n">stim_const</span><span class="p">[</span><span class="n">idx_mod_gas</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">x0</span><span class="p">[</span><span class="n">vars_chem</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">mod_gas</span><span class="p">)]</span> <span class="o">/</span> <span class="mi">2</span>
<span class="n">stim_const</span><span class="p">[</span><span class="n">idx_mod_gas</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">period</span><span class="p">)</span>

<span class="n">ans3</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">integrate</span><span class="o">.</span><span class="n">solve_ivp</span><span class="p">(</span><span class="n">stim_sin</span><span class="p">,</span> 
                                 <span class="n">t_span</span><span class="p">,</span> 
                                 <span class="n">x0</span><span class="p">,</span>
                                 <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">TestModel</span><span class="o">.</span><span class="n">reaction</span><span class="p">,</span> <span class="n">stim_const</span><span class="p">],</span>
                                 <span class="n">rtol</span><span class="o">=</span><span class="n">RelTol</span><span class="p">,</span> 
                                 <span class="n">atol</span><span class="o">=</span><span class="n">AbsTol</span><span class="p">,</span>
                                 <span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Disturbed H$_2$ feed&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Coverage &#39;</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">&#39;$\theta$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">vars_chem</span><span class="p">[:</span><span class="o">-</span><span class="mi">5</span><span class="p">]):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ans3</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">ans3</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>

<span class="n">h</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="n">h</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper right&quot;</span><span class="p">,</span> 
          <span class="n">ncol</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vars_chem</span><span class="p">[:</span><span class="o">-</span><span class="mi">5</span><span class="p">])</span><span class="o">/</span><span class="mi">3</span><span class="p">)),</span>
          <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span>
          <span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/DefiningModel_22_0.png" src="_images/DefiningModel_22_0.png" />
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "myenv"
        },
        kernelOptions: {
            kernelName: "myenv",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'myenv'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="modelintro.html" title="previous page">Revealing reaction behaviour by modulation</a>
    <a class='right-next' id="next-link" href="MES-PSD_intro.html" title="next page">PSD analysis of different cases of (simulated) reaction systems</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Felix Hemmingsson<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>